{"version":3,"file":"CallComposite.js","sourceRoot":"","sources":["../../../../../../preprocess-dist/react-composites/src/composites/CallComposite/CallComposite.tsx"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { _isInCall } from '@internal/calling-component-bindings';\nimport { OnRenderAvatarCallback, ParticipantMenuItemsCallback } from '@internal/react-components';\nimport React, { useEffect, useMemo } from 'react';\nimport { AvatarPersonaDataCallback } from '../common/AvatarPersona';\nimport { BaseProvider, BaseCompositeProps } from '../common/BaseComposite';\nimport { CallCompositeIcons } from '../common/icons';\nimport { useLocale } from '../localization';\nimport { CommonCallAdapter } from './adapter/CallAdapter';\nimport { CallAdapterProvider, useAdapter } from './adapter/CallAdapterProvider';\nimport { CallPage } from './pages/CallPage';\nimport { ConfigurationPage } from './pages/ConfigurationPage';\nimport { NoticePage } from './pages/NoticePage';\nimport { useSelector } from './hooks/useSelector';\nimport { getPage } from './selectors/baseSelectors';\nimport { LobbyPage } from './pages/LobbyPage';\nimport { mainScreenContainerStyleDesktop, mainScreenContainerStyleMobile } from './styles/CallComposite.styles';\nimport { CallControlOptions } from './types/CallControlOptions';\nimport { PermissionConstraints } from '@azure/communication-calling';\n\n/**\n * Props for {@link CallComposite}.\n *\n * @public\n */\nexport interface CallCompositeProps extends BaseCompositeProps<CallCompositeIcons> {\n  /**\n   * An adapter provides logic and data to the composite.\n   * Composite can also be controlled using the adapter.\n   */\n  adapter: CommonCallAdapter;\n  /**\n   * Optimizes the composite form factor for either desktop or mobile.\n   * @remarks `mobile` is currently only optimized for Portrait mode on mobile devices and does not support landscape.\n   * @defaultValue 'desktop'\n   */\n  formFactor?: 'desktop' | 'mobile';\n  /**\n   * URL to invite new participants to the current call. If this is supplied, a button appears in the Participants\n   * Button flyout menu.\n   */\n  callInvitationUrl?: string;\n  /**\n   * Flags to enable/disable or customize UI elements of the {@link CallComposite}.\n   */\n  options?: CallCompositeOptions;\n}\n/**\n * Optional features of the {@link CallComposite}.\n *\n * @public\n */\nexport type CallCompositeOptions = {\n  /**\n   * Surface Azure Communication Services backend errors in the UI with {@link @azure/communication-react#ErrorBar}.\n   * Hide or show the error bar.\n   * @defaultValue true\n   */\n  errorBar?: boolean;\n  /**\n   * Hide or Customize the control bar element.\n   * Can be customized by providing an object of type {@link @azure/communication-react#CallControlOptions}.\n   * @defaultValue true\n   */\n  callControls?: boolean | CallControlOptions;\n};\ntype MainScreenProps = {\n  mobileView: boolean;\n  onRenderAvatar?: OnRenderAvatarCallback;\n  callInvitationUrl?: string;\n  onFetchAvatarPersonaData?: AvatarPersonaDataCallback;\n  onFetchParticipantMenuItems?: ParticipantMenuItemsCallback;\n  options?: CallCompositeOptions;\n};\nconst MainScreen = (props: MainScreenProps): JSX.Element => {\n  const {\n    callInvitationUrl,\n    onRenderAvatar,\n    onFetchAvatarPersonaData,\n    onFetchParticipantMenuItems\n  } = props;\n  const page = useSelector(getPage);\n  const adapter = useAdapter();\n  const locale = useLocale();\n  let pageElement: JSX.Element | undefined;\n  switch (page) {\n    case 'configuration':\n      pageElement = <ConfigurationPage mobileView={props.mobileView} startCallHandler={(): void => {\n        adapter.joinCall();\n      }} />;\n      break;\n    case 'accessDeniedTeamsMeeting':\n      pageElement = <NoticePage iconName=\"NoticePageAccessDeniedTeamsMeeting\" title={locale.strings.call.failedToJoinTeamsMeetingReasonAccessDeniedTitle} moreDetails={locale.strings.call.failedToJoinTeamsMeetingReasonAccessDeniedMoreDetails} dataUiId={'access-denied-teams-meeting-page'} />;\n      break;\n    case 'removedFromCall':\n      pageElement = <NoticePage iconName=\"NoticePageRemovedFromCall\" title={locale.strings.call.removedFromCallTitle} moreDetails={locale.strings.call.removedFromCallMoreDetails} dataUiId={'removed-from-call-page'} />;\n      break;\n    case 'joinCallFailedDueToNoNetwork':\n      pageElement = <NoticePage iconName=\"NoticePageJoinCallFailedDueToNoNetwork\" title={locale.strings.call.failedToJoinCallDueToNoNetworkTitle} moreDetails={locale.strings.call.failedToJoinCallDueToNoNetworkMoreDetails} dataUiId={'join-call-failed-due-to-no-network-page'} />;\n      break;\n    case 'leftCall':\n      pageElement = <NoticePage iconName=\"NoticePageLeftCall\" title={locale.strings.call.leftCallTitle} moreDetails={locale.strings.call.leftCallMoreDetails} dataUiId={'left-call-page'} />;\n      break;\n    case 'lobby':\n      pageElement = <LobbyPage mobileView={props.mobileView} options={props.options} />;\n      break;\n    case 'call':\n      pageElement = <CallPage onRenderAvatar={onRenderAvatar} callInvitationURL={callInvitationUrl} onFetchAvatarPersonaData={onFetchAvatarPersonaData} onFetchParticipantMenuItems={onFetchParticipantMenuItems} mobileView={props.mobileView} options={props.options} />;\n      break;\n    /* @conditional-compile-remove(PSTN-calls) */ /* @conditional-compile-remove(one-to-n-calling) */\n    case holdPageTrampoline():\n      pageElement = <>\n          {}\n        </>;\n      break;\n  }\n  if (!pageElement) {\n    throw new Error('Invalid call composite page');\n  }\n  // default retElement for stable version\n  let retElement = pageElement;\n  return retElement;\n};\n\n/**\n * A customizable UI composite for calling experience.\n *\n * @remarks Call composite min width/height are as follow:\n * - mobile: 17.5rem x 21rem (280px x 336px, with default rem at 16px)\n * - desktop: 30rem x 22rem (480px x 352px, with default rem at 16px)\n *\n * @public\n */\nexport const CallComposite = (props: CallCompositeProps): JSX.Element => {\n  const {\n    adapter,\n    callInvitationUrl,\n    onFetchAvatarPersonaData,\n    onFetchParticipantMenuItems,\n    options,\n    formFactor = 'desktop'\n  } = props;\n  useEffect(() => {\n    (async () => {\n      const constrain = getQueryOptions({});\n      await adapter.askDevicePermission(constrain);\n      adapter.queryCameras();\n      adapter.queryMicrophones();\n      adapter.querySpeakers();\n    })();\n  }, [adapter]);\n  const mobileView = formFactor === 'mobile';\n  const mainScreenContainerClassName = useMemo(() => {\n    return mobileView ? mainScreenContainerStyleMobile : mainScreenContainerStyleDesktop;\n  }, [mobileView]);\n  return <div className={mainScreenContainerClassName}>\n      <BaseProvider {...props}>\n        <CallAdapterProvider adapter={adapter}>\n          <MainScreen callInvitationUrl={callInvitationUrl} onFetchAvatarPersonaData={onFetchAvatarPersonaData} onFetchParticipantMenuItems={onFetchParticipantMenuItems} mobileView={mobileView} options={options} />\n          {// This layer host is for ModalLocalAndRemotePIP in CallPane. This LayerHost cannot be inside the CallPane\n        // because when the CallPane is hidden, ie. style property display is 'none', it takes up no space. This causes problems when dragging\n        // the Modal because the draggable bounds thinks it has no space and will always return to its initial position after dragging.\n        // Additionally, this layer host cannot be in the Call Arrangement as it needs to be rendered before useMinMaxDragPosition() in\n        // common/utils useRef is called.\n        // Warning: this is fragile and works because the call arrangement page is only rendered after the call has connected and thus this\n        // LayerHost will be guaranteed to have rendered (and subsequently mounted in the DOM). This ensures the DOM element will be available\n        // before the call to `document.getElementById(modalLayerHostId)` is made.\n        }\n        </CallAdapterProvider>\n      </BaseProvider>\n    </div>;\n};\nconst holdPageTrampoline = (): string => {\n  return 'call';\n};\nconst getQueryOptions = (options: {}): PermissionConstraints => {\n  return {\n    video: true,\n    audio: true\n  };\n};\"../../../../calling-component-bindings/src\"\"../../../../react-components/src\""]}