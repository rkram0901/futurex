{"version":3,"sources":["components/Embed/Embed.tsx"],"names":["embedBehavior","PropTypes","React","customPropTypes","createShorthandFactory","commonPropTypes","Image","Video","Box","Ref","getElementType","useUnhandledProps","useFluentContext","useAutoControlled","useAccessibility","useTelemetry","useStyles","embedClassName","embedSlotClassNames","control","Embed","forwardRef","props","ref","context","displayName","telemetry","setStart","setEnd","alt","title","iframe","placeholder","video","variables","styles","className","design","ElementType","unhandledProps","handledProps","getA11yProps","accessibility","debugName","actionHandlers","performClick","event","handleClick","mapPropsToBehavior","rtl","defaultValue","defaultActive","value","active","initialValue","setACtive","useState","iframeLoaded","setIframeLoaded","frameRef","useRef","e","stopPropagation","preventDefault","iframeNil","newActive","handleFrameOverrides","predefinedProps","onLoad","current","contentWindow","focus","mapPropsToStyles","mapPropsToInlineStyles","classes","resolvedStyles","placeholderElement","image","width","height","hasIframe","hasVideo","controlVisible","placeholderVisible","element","root","onClick","create","defaultProps","autoPlay","controls","loop","muted","poster","as","overrideProps","propTypes","createCommon","children","content","bool","itemShorthand","every","disallow","onActiveChange","func","string","Object","keys","Component"],"mappings":"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","sourcesContent":["import { Accessibility, embedBehavior, EmbedBehaviorProps } from '@fluentui/accessibility';\nimport * as _ from 'lodash';\nimport * as PropTypes from 'prop-types';\nimport * as React from 'react';\nimport * as customPropTypes from '@fluentui/react-proptypes';\n\nimport { createShorthandFactory, UIComponentProps, commonPropTypes } from '../../utils';\nimport { Image } from '../Image/Image';\nimport { Video, VideoProps } from '../Video/Video';\nimport { Box, BoxProps } from '../Box/Box';\nimport { ComponentEventHandler, ShorthandValue, FluentComponentStaticProps } from '../../types';\nimport { Ref } from '@fluentui/react-component-ref';\nimport {\n  getElementType,\n  useUnhandledProps,\n  useFluentContext,\n  useAutoControlled,\n  useAccessibility,\n  useTelemetry,\n  useStyles,\n  ForwardRefWithAs,\n} from '@fluentui/react-bindings';\n\nexport interface EmbedSlotClassNames {\n  control: string;\n}\n\nexport interface EmbedProps extends UIComponentProps {\n  /** Accessibility behavior if overridden by the user. */\n  accessibility?: Accessibility<EmbedBehaviorProps>;\n\n  /** Alternative text. */\n  alt?: string;\n\n  /** Corresponds to HTML title attribute. */\n  title?: string;\n\n  /** Whether the embedded object should be active. */\n  active?: boolean;\n\n  /** Whether the embedded object should start active. */\n  defaultActive?: boolean;\n\n  /** Shorthand for an control. */\n  control?: ShorthandValue<BoxProps>;\n\n  /** Shorthand for an embedded iframe. */\n  iframe?: ShorthandValue<BoxProps>;\n\n  /**\n   * Event for request to change 'active' value.\n   * @param event - React's original SyntheticEvent.\n   * @param data - All props and proposed value.\n   */\n  onActiveChange?: ComponentEventHandler<EmbedProps>;\n\n  /**\n   * Called when is clicked.\n   *\n   * @param event - React's original SyntheticEvent.\n   * @param data - All item props.\n   */\n  onClick?: ComponentEventHandler<EmbedProps>;\n\n  /** Image source URL for when video isn't playing. */\n  placeholder?: string;\n\n  /** Shorthand for an embedded video. */\n  video?: ShorthandValue<VideoProps>;\n}\n\nexport const embedClassName = 'ui-embed';\nexport const embedSlotClassNames: EmbedSlotClassNames = {\n  control: `${embedClassName}__control`,\n};\n\nexport type EmbedStylesProps = Required<Pick<EmbedProps, 'active'>> & { iframeLoaded: boolean };\n\n/**\n * An Embed displays content from external websites, like a post from external social network.\n *\n * @accessibility\n * A `placeholder` slot represents an [`Image`](/components/image/definition) component, please follow recommendations from its\n * accessibility section.\n */\nexport const Embed = (React.forwardRef<HTMLSpanElement, EmbedProps>((props, ref) => {\n  const context = useFluentContext();\n  const { setStart, setEnd } = useTelemetry(Embed.displayName, context.telemetry);\n  setStart();\n  const { alt, title, control, iframe, placeholder, video, variables, styles, className, design } = props;\n  const ElementType = getElementType(props);\n  const unhandledProps = useUnhandledProps(Embed.handledProps, props);\n\n  const getA11yProps = useAccessibility<EmbedBehaviorProps>(props.accessibility, {\n    debugName: Embed.displayName,\n    actionHandlers: {\n      performClick: event => handleClick(event),\n    },\n    mapPropsToBehavior: () => ({\n      alt,\n      title,\n    }),\n    rtl: context.rtl,\n  });\n\n  const [active, setACtive] = useAutoControlled({\n    defaultValue: props.defaultActive,\n    value: props.active,\n    initialValue: false,\n  });\n\n  const [iframeLoaded, setIframeLoaded] = React.useState(false);\n  const frameRef = React.useRef<HTMLFrameElement>();\n\n  const handleClick = e => {\n    e.stopPropagation();\n    e.preventDefault();\n\n    const iframeNil = _.isNil(props.iframe);\n    const newActive = !active;\n\n    if (iframeNil || (!iframeNil && newActive)) {\n      setACtive(newActive);\n      _.invoke(props, 'onActiveChange', e, { ...props, active: newActive });\n    }\n\n    _.invoke(props, 'onClick', e, { ...props, active: newActive });\n  };\n\n  const handleFrameOverrides = predefinedProps => ({\n    onLoad: (e: React.SyntheticEvent) => {\n      _.invoke(predefinedProps, 'onLoad', e);\n      setIframeLoaded(true);\n      frameRef.current.contentWindow.focus();\n    },\n  });\n\n  const { classes, styles: resolvedStyles } = useStyles<EmbedStylesProps>(Embed.displayName, {\n    className: embedClassName,\n    mapPropsToStyles: () => ({\n      iframeLoaded,\n      active,\n    }),\n    mapPropsToInlineStyles: () => ({\n      className,\n      design,\n      styles,\n      variables,\n    }),\n    rtl: context.rtl,\n  });\n\n  const placeholderElement = placeholder ? (\n    <Image\n      src={placeholder}\n      styles={resolvedStyles.image}\n      variables={{ width: variables.width, height: variables.height }}\n    />\n  ) : null;\n\n  const hasIframe = !_.isNil(iframe);\n  const hasVideo = !_.isNil(video);\n  const controlVisible = !active || hasVideo;\n  const placeholderVisible = !active || (hasIframe && active && !iframeLoaded);\n\n  const element = (\n    <ElementType\n      {...getA11yProps('root', {\n        className: classes.root,\n        onClick: handleClick,\n        ref,\n        ...unhandledProps,\n      })}\n    >\n      {active && (\n        <>\n          {Video.create(video, {\n            defaultProps: () =>\n              getA11yProps('video', {\n                autoPlay: true,\n                controls: false,\n                loop: true,\n                muted: true,\n                poster: placeholder,\n                styles: resolvedStyles.video,\n                variables: {\n                  width: variables.width,\n                  height: variables.height,\n                },\n              }),\n          })}\n          {iframe && (\n            <Ref innerRef={frameRef}>\n              {Box.create(iframe, {\n                defaultProps: () =>\n                  getA11yProps('iframe', {\n                    as: 'iframe',\n                    styles: resolvedStyles.iframe,\n                  }),\n                overrideProps: handleFrameOverrides,\n              })}\n            </Ref>\n          )}\n        </>\n      )}\n\n      {placeholderVisible && placeholderElement}\n      {controlVisible &&\n        Box.create(control, {\n          defaultProps: () =>\n            getA11yProps('control', {\n              className: embedSlotClassNames.control,\n              styles: resolvedStyles.control,\n            }),\n        })}\n    </ElementType>\n  );\n\n  setEnd();\n\n  return element;\n}) as unknown) as ForwardRefWithAs<'span', HTMLSpanElement, EmbedProps> & FluentComponentStaticProps<EmbedProps>;\n\nEmbed.displayName = 'Embed';\n\nEmbed.propTypes = {\n  ...commonPropTypes.createCommon({\n    children: false,\n    content: false,\n  }),\n  active: PropTypes.bool,\n  defaultActive: PropTypes.bool,\n  control: customPropTypes.itemShorthand,\n  iframe: customPropTypes.every([customPropTypes.disallow(['video']), customPropTypes.itemShorthand]),\n  onActiveChange: PropTypes.func,\n  onClick: PropTypes.func,\n  placeholder: PropTypes.string,\n  video: customPropTypes.every([customPropTypes.disallow(['iframe']), customPropTypes.itemShorthand]),\n};\n\nEmbed.defaultProps = {\n  as: 'span' as const,\n  accessibility: embedBehavior,\n  control: {},\n  variables: {},\n};\n\nEmbed.handledProps = Object.keys(Embed.propTypes) as any;\n\nEmbed.create = createShorthandFactory({ Component: Embed });\n"],"file":"Embed.js"}